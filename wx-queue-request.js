!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e["wx-queue-request"]=e["wx-queue-request"]||{})}(this,function(e){"use strict";function n(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if("function"!=typeof e)throw Error("request must be function");var c=function(e,n){return t(n),{concurrency:n,push:function(e,n){var t=this;r.push({task:e,callback:n}),setTimeout(function(){t.process()},0)},process:function(){for(var n=this,t=function(){var t=r.shift();o.push(t),e(t.task,u(function(){n.pull(t),"function"==typeof t.callback&&t.callback.apply(t,arguments),n.process()}))};this.concurrency>o.length&&r.length;)t()},pull:function(e){var n=o.indexOf(e);-1!==n&&o.splice(n,1)}}}(function(e,n){return e(n)},n);return function(n){c.push(function(t){var u=n.complete;n.complete=function(){t(),"function"==typeof u&&u.apply(void 0,arguments)},e(n)})}}var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");return e},u=function(e){return function(){if(null===e)throw new Error("Callback was already called");var n=e;return e=null,n.apply(void 0,arguments)}},r=[],o=[];e.queueRequest=n,e.queue=function(e){var t=wx.request;Object.defineProperty(wx,"request",{get:function(){return n(t,e)}})},Object.defineProperty(e,"__esModule",{value:!0})});
